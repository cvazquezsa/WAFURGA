[Thread: 17608] [DEBUG] [18:26:12.672] SELECT 
oap.creationdate,
c.externalid numerocliente,
c.name cliente,
oap.[folio],
sdp.amount,
dt.name documento,
oap.documenttypeid,
dc.name concepto,
sdp.tendertypename as "FormaPago",
u.login usuario,
s.name tienda, 
s.number
FROM OnAccountPayment oap
LEFT JOIN customer c ON c.UUID = oap.customeruuid
LEFT JOIN documentconcept dc ON dc.id = oap.documentconceptid
inner join (SELECT OnAccountPaymentUUID,CONCAT(TenderTypeName, ' ', CASE WHEN ISNULL(sc.Folio,'')='' THEN sc.IdCard                    else sc.Folio END) TernderTypeName,SUM(Amount) Amount
	FROM SaleDocumentPayment
	GROUP BY OnAccountPaymentUUID,TenderTypeName, sc.Folio, sc.IdCard
        UNION ALL
        SELECT scu.OnAccountPaymentUUID, tt.Name, SUM(scu.amount) Amount
          FROM StoreCreditUsed scu
            JOIN TenderType tt ON scu.TenderTypeId=tt.ID
            JOIN StoreCredit sc ON sc.UUID=scu.StoreCreditUUID
          GROUP BY scu.OnAccountPaymentUUID, tt.Name) sdp on sdp.onaccountpaymentUUID = oap.UUID
LEFT JOIN documenttype dt ON dt.id = oap.documenttypeid
LEFT JOIN [user] u on u.id = oap.creationuserid
LEFT JOIN store s on s.id = oap.storeid
WHERE oap.uuid = '0DC73469-9B80-48CE-8017-761128A28D8F'

